configure_task_variables:
  stage: .pre
  script:
    - tasks=`./gradlew tasks --all`
    - if (grep -q pmdMain <<< "$tasks"); then echo "QUALITY_CHECK_DISABLED=false" >> build.env; fi;
    - if (grep -q checkLicense <<< "$tasks"); then echo "DEPENDENCY_LICENSE_SCANNING_DISABLED=false" >> build.env; fi;
    - if (grep -q 17 <<< "$DEFAULT_IMAGE"); then echo "SAST_DISABLED=false" >> build.env; fi;
# TODO: Enable this after additional testing on JDK 11
#    - if (grep -q 11 <<< "$DEFAULT_IMAGE"); then echo "$SAST_DISABLED=false" echo "$ASDF_JAVA_VERSION_OVERRIDE=adoptopenjdk-11.0.14+101">> build.env; fi;
  artifacts:
    reports:
      dotenv: build.env
  rules:
    - if: $AUTO_CONFIGURATION_DISABLED
      when: never
    - if: $CI_COMMIT_TAG
      when: never
    - if: $CI_MERGE_REQUEST_IID
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
    - if: $CI_COMMIT_BRANCH =~ $DEV_OR_RELEASE_REGEX
    - if: $CI_PIPELINE_SOURCE == "web"